// Definição dos Ciclos
export const ciclos = [
    { nome: "Ciclo 1", semanas: [
        { inicio: "2024-12-29", fim: "2025-01-04" },
        { inicio: "2025-01-05", fim: "2025-01-11" },
        { inicio: "2025-01-12", fim: "2025-01-18" },
        { inicio: "2025-01-19", fim: "2025-01-25" },
        { inicio: "2025-01-26", fim: "2025-02-01" }
    ]},
    { nome: "Ciclo 2", semanas: [
        { inicio: "2025-02-02", fim: "2025-02-08" },
        { inicio: "2025-02-09", fim: "2025-02-15" },
        { inicio: "2025-02-16", fim: "2025-02-22" },
        { inicio: "2025-02-23", fim: "2025-03-01" }
    ]},
    { nome: "Ciclo 3", semanas: [
        { inicio: "2025-03-02", fim: "2025-03-08" },
        { inicio: "2025-03-09", fim: "2025-03-15" },
        { inicio: "2025-03-16", fim: "2025-03-22" },
        { inicio: "2025-03-23", fim: "2025-03-29" },
        { inicio: "2025-03-30", fim: "2025-04-05" }
    ]},
    { nome: "Ciclo 4", semanas: [
        { inicio: "2025-04-06", fim: "2025-04-12" },
        { inicio: "2025-04-13", fim: "2025-04-19" },
        { inicio: "2025-04-20", fim: "2025-04-26" },
        { inicio: "2025-04-27", fim: "2025-05-03" }
    ]},
    { nome: "Ciclo 5", semanas: [
        { inicio: "2025-05-04", fim: "2025-05-10" },
        { inicio: "2025-05-11", fim: "2025-05-17" },
        { inicio: "2025-05-18", fim: "2025-05-24" },
        { inicio: "2025-05-25", fim: "2025-05-31" }
    ]},
    { nome: "Ciclo 6", semanas: [
        { inicio: "2025-06-01", fim: "2025-06-07" },
        { inicio: "2025-06-08", fim: "2025-06-14" },
        { inicio: "2025-06-15", fim: "2025-06-21" },
        { inicio: "2025-06-22", fim: "2025-06-28" }
    ]},
    { nome: "Ciclo 7", semanas: [
        { inicio: "2025-06-29", fim: "2025-07-05" },
        { inicio: "2025-07-06", fim: "2025-07-12" },
        { inicio: "2025-07-13", fim: "2025-07-19" },
        { inicio: "2025-07-20", fim: "2025-07-26" }
    ]},
    { nome: "Ciclo 8", semanas: [
        { inicio: "2025-07-27", fim: "2025-08-02" },
        { inicio: "2025-08-03", fim: "2025-08-09" },
        { inicio: "2025-08-10", fim: "2025-08-16" },
        { inicio: "2025-08-17", fim: "2025-08-23" },
        { inicio: "2025-08-24", fim: "2025-08-30" }
    ]},
    { nome: "Ciclo 9", semanas: [
        { inicio: "2025-08-31", fim: "2025-09-06" },
        { inicio: "2025-09-07", fim: "2025-09-13" },
        { inicio: "2025-09-14", fim: "2025-09-20" },
        { inicio: "2025-09-21", fim: "2025-09-27" }
    ]},
    { nome: "Ciclo 10", semanas: [
        { inicio: "2025-09-28", fim: "2025-10-04" },
        { inicio: "2025-10-05", fim: "2025-10-11" },
        { inicio: "2025-10-12", fim: "2025-10-18" },
        { inicio: "2025-10-19", fim: "2025-10-25" }
    ]},
    { nome: "Ciclo 11", semanas: [
        { inicio: "2025-10-26", fim: "2025-11-01" },
        { inicio: "2025-11-02", fim: "2025-11-08" },
        { inicio: "2025-11-09", fim: "2025-11-15" },
        { inicio: "2025-11-16", fim: "2025-11-22" },
        { inicio: "2025-11-23", fim: "2025-11-29" }
    ]},
    { nome: "Ciclo 12", semanas: [
        { inicio: "2025-11-30", fim: "2025-12-06" },
        { inicio: "2025-12-07", fim: "2025-12-13" },
        { inicio: "2025-12-14", fim: "2025-12-20" },
        { inicio: "2025-12-21", fim: "2025-12-27" }
    ]},
    { nome: "Ciclo 13", semanas: [
        { inicio: "2025-12-28", fim: "2026-01-03" },
        { inicio: "2026-01-04", fim: "2026-01-10" },
        { inicio: "2026-01-11", fim: "2026-01-17" },
        { inicio: "2026-01-18", fim: "2026-01-24" },
        { inicio: "2026-01-25", fim: "2026-01-31" }
    ]},
    { nome: "Ciclo 14", semanas: [
        { inicio: "2026-02-01", fim: "2026-02-07" },
        { inicio: "2026-02-08", fim: "2026-02-14" },
        { inicio: "2026-02-15", fim: "2026-02-21" },
        { inicio: "2026-02-22", fim: "2026-02-28" }
    ]},
    { nome: "Ciclo 15", semanas: [
        { inicio: "2026-03-01", fim: "2026-03-07" },
        { inicio: "2026-03-08", fim: "2026-03-14" },
        { inicio: "2026-03-15", fim: "2026-03-21" },
        { inicio: "2026-03-22", fim: "2026-03-28" }
    ]},
    { nome: "Ciclo 16", semanas: [
        { inicio: "2026-03-29", fim: "2026-04-04" },
        { inicio: "2026-04-05", fim: "2026-04-11" },
        { inicio: "2026-04-12", fim: "2026-04-18" },
        { inicio: "2026-04-19", fim: "2026-04-25" }
    ]},
    { nome: "Ciclo 17", semanas: [
        { inicio: "2026-04-26", fim: "2026-05-02" },
        { inicio: "2026-05-03", fim: "2026-05-09" },
        { inicio: "2026-05-10", fim: "2026-05-16" },
        { inicio: "2026-05-17", fim: "2026-05-23" },
        { inicio: "2026-05-24", fim: "2026-05-30" }
    ]},
    { nome: "Ciclo 18", semanas: [
        { inicio: "2026-05-31", fim: "2026-06-06" },
        { inicio: "2026-06-07", fim: "2026-06-13" },
        { inicio: "2026-06-14", fim: "2026-06-20" },
        { inicio: "2026-06-21", fim: "2026-06-27" }
    ]},
    { nome: "Ciclo 19", semanas: [
        { inicio: "2026-06-28", fim: "2026-07-04" },
        { inicio: "2026-07-05", fim: "2026-07-11" },
        { inicio: "2026-07-12", fim: "2026-07-18" },
        { inicio: "2026-07-19", fim: "2026-07-25" }
    ]},
    { nome: "Ciclo 20", semanas: [
        { inicio: "2026-07-26", fim: "2026-08-01" },
        { inicio: "2026-08-02", fim: "2026-08-08" },
        { inicio: "2026-08-09", fim: "2026-08-15" },
        { inicio: "2026-08-16", fim: "2026-08-22" },
        { inicio: "2026-08-23", fim: "2026-08-29" }
    ]},
    { nome: "Ciclo 21", semanas: [
        { inicio: "2026-08-30", fim: "2026-09-05" },
        { inicio: "2026-09-06", fim: "2026-09-12" },
        { inicio: "2026-09-13", fim: "2026-09-19" },
        { inicio: "2026-09-20", fim: "2026-09-26" }
    ]},
    { nome: "Ciclo 22", semanas: [
        { inicio: "2026-09-27", fim: "2026-10-03" },
        { inicio: "2026-10-04", fim: "2026-10-10" },
        { inicio: "2026-10-11", fim: "2026-10-17" },
        { inicio: "2026-10-18", fim: "2026-10-24" }
    ]},
    { nome: "Ciclo 23", semanas: [
        { inicio: "2026-10-25", fim: "2026-10-31" },
        { inicio: "2026-11-01", fim: "2026-11-07" },
        { inicio: "2026-11-08", fim: "2026-11-14" },
        { inicio: "2026-11-15", fim: "2026-11-21" },
        { inicio: "2026-11-22", fim: "2026-11-28" }
    ]},
    { nome: "Ciclo 24", semanas: [
        { inicio: "2026-11-29", fim: "2026-12-05" },
        { inicio: "2026-12-06", fim: "2026-12-12" },
        { inicio: "2026-12-13", fim: "2026-12-19" },
        { inicio: "2026-12-20", fim: "2026-12-26" }
    ]},
    { nome: "Ciclo 25", semanas: [
        { inicio: "2026-12-27", fim: "2027-01-02" },
        { inicio: "2027-01-03", fim: "2027-01-09" },
        { inicio: "2027-01-10", fim: "2027-01-16" },
        { inicio: "2027-01-17", fim: "2027-01-23" },
        { inicio: "2027-01-24", fim: "2027-01-30" }
    ]},
    { nome: "Ciclo 26", semanas: [
        { inicio: "2027-01-31", fim: "2027-02-06" },
        { inicio: "2027-02-07", fim: "2027-02-13" },
        { inicio: "2027-02-14", fim: "2027-02-20" },
        { inicio: "2027-02-21", fim: "2027-02-27" }
    ]},
    { nome: "Ciclo 27", semanas: [
        { inicio: "2027-02-28", fim: "2027-03-06" },
        { inicio: "2027-03-07", fim: "2027-03-13" },
        { inicio: "2027-03-14", fim: "2027-03-20" },
        { inicio: "2027-03-21", fim: "2027-03-27" }
    ]},
    { nome: "Ciclo 28", semanas: [
        { inicio: "2027-03-28", fim: "2027-04-03" },
        { inicio: "2027-04-04", fim: "2027-04-10" },
        { inicio: "2027-04-11", fim: "2027-04-17" },
        { inicio: "2027-04-18", fim: "2027-04-24" }
    ]},
    { nome: "Ciclo 29", semanas: [
        { inicio: "2027-04-25", fim: "2027-05-01" },
        { inicio: "2027-05-02", fim: "2027-05-08" },
        { inicio: "2027-05-09", fim: "2027-05-15" },
        { inicio: "2027-05-16", fim: "2027-05-22" },
        { inicio: "2027-05-23", fim: "2027-05-29" }
    ]},
    { nome: "Ciclo 30", semanas: [
        { inicio: "2027-05-30", fim: "2027-06-05" },
        { inicio: "2027-06-06", fim: "2027-06-12" },
        { inicio: "2027-06-13", fim: "2027-06-19" },
        { inicio: "2027-06-20", fim: "2027-06-26" }
    ]}
];

export function getCicloAtual() {
    const hoje = new Date();
    for (const ciclo of ciclos) {
        for (const semana of ciclo.semanas) {
            const inicio = new Date(semana.inicio);
            const fim = new Date(semana.fim);
            // Ajusta o horário para evitar problemas de fuso
            inicio.setHours(0, 0, 0, 0);
            fim.setHours(23, 59, 59, 999);
            if (hoje >= inicio && hoje <= fim) {
                return {
                    ciclo: ciclo.nome,
                    semana: {
                        inicio: inicio,
                        fim: fim
                    }
                };
            }
        }
    }
    return null; // Caso não encontre a semana atual
}

export function getObjetoCicloCompletoAtual(dataReferencia = new Date()) {
    // Normaliza a data de referência para meia-noite no fuso horário local, evitando erros de "dia anterior"
    const hoje = new Date(dataReferencia.getFullYear(), dataReferencia.getMonth(), dataReferencia.getDate());

    for (const ciclo of ciclos) {
        if (!ciclo.semanas || ciclo.semanas.length === 0) continue;

        for (let i = 0; i < ciclo.semanas.length; i++) {
            const semana = ciclo.semanas[i];
            
            // Converte as strings de data para objetos Date, tratando-as como locais
            const inicioSemana = new Date(semana.inicio + 'T00:00:00');
            const fimSemana = new Date(semana.fim + 'T23:59:59');

            if (hoje >= inicioSemana && hoje <= fimSemana) {
                // Encontramos a semana! Agora, criamos um objeto de resposta limpo.
                const semanaEncontrada = {
                    ...semana, // Copia 'inicio' e 'fim'
                    numero_semana: i + 1, // Adiciona o número da semana
                    // Converte para objetos Date para uso no backend
                    inicio: inicioSemana, 
                    fim: fimSemana
                };
                
                // Retorna uma cópia do objeto do ciclo com a semana atual anexada
                return {
                    nome: ciclo.nome,
                    semanas: ciclo.semanas, // Mantém a lista original de semanas
                    semana: semanaEncontrada // Adiciona a semana atual encontrada
                };
            }
        }
    }

    // Se o loop terminar e não encontrar nada
    console.warn("Nenhum ciclo ou semana ativa encontrada para a data:", hoje);
    return null;
}
