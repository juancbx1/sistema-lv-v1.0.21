<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meu Dashboard</title>
    <link rel="stylesheet" href="/dashboard/dashboard.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
</head>

<body class="ds-body">

    <!-- CABEÇALHO PRINCIPAL -->
    <header class="ds-header-principal">
        <div class="ds-identidade-bloco">
            <div class="ds-identidade-avatar">
                <img id="header-avatar-img" src="/img/default-avatar.png" alt="Avatar do colaborador">
                <span id="header-level-badge" class="ds-identidade-level-badge">?</span>
            </div>
            <div class="ds-identidade-info">
                <h1 id="header-nome-usuario">Carregando...</h1>
                <p id="header-cargo-nivel">Colaborador(a)</p>
            </div>
        </div>

        <div class="ds-actions-bloco">
            <button id="btnAcaoMural" class="ds-action-btn" title="Central de Comunicação">
                <i class="fas fa-bullhorn"></i>
                <span id="badgeMural" class="ds-badge" style="display: none;">0</span>
            </button>
            <button id="btnAcaoAssinatura" class="ds-action-btn" title="Assinaturas Pendentes">
                <i class="fas fa-file-signature"></i>
                <span id="badgeAssinatura" class="ds-badge" style="display: none;">0</span>
            </button>

            <button id="btnAcaoSuporte" class="ds-action-btn" title="Suporte & Sugestões">
            <i class="fas fa-headset"></i>
            <span id="badgeSuporte" class="ds-badge" style="display: none;">0</span>
        </button>

            <a href="/dashboard/desempenho.html" class="ds-action-btn" title="Meu Desempenho">
                <i class="fas fa-chart-line"></i>
            </a>
            <button id="btnAcaoPerfil" class="ds-action-btn" title="Meu Perfil">
                <i class="fas fa-user-cog"></i>
            </button>
            <button id="logoutBtn" class="ds-action-btn ds-btn-sair" title="Sair">
                <i class="fas fa-sign-out-alt"></i>
            </button>
        </div>
    </header>

    <!-- CONTEÚDO PRINCIPAL DA PÁGINA -->
    <main class="ds-container-principal">
        
        <!-- PAINEL DE DESEMPENHO -->
        <section class="ds-painel-desempenho">
            <!-- SEÇÃO 1: FOCO DO DIA -->
            <div class="ds-foco-diario">
            <div class="ds-progress-ring-container">
                <svg class="ds-progress-ring" width="160" height="160">
                    <circle class="ds-progress-ring-bg" stroke-width="12" r="74" cx="80" cy="80" />
                    <circle id="progress-ring-fg" class="ds-progress-ring-fg" stroke-width="12" r="74" cx="80" cy="80" />
                </svg>
                <div id="foco-diario-texto-central" class="ds-progress-ring-texto">
                    <span id="foco-texto-principal" class="ds-texto-grande">--</span>
                    <span id="foco-texto-secundario" class="ds-texto-pequeno">pontos hoje</span>
                </div>
            </div>
            
            <!-- Pílulas de Apoio (ficam sempre visíveis, exceto no estado final) -->
            <div id="container-pilulas-apoio" class="ds-foco-diario-legenda-container">
                <div id="legenda-ritmo-dia" class="ds-legenda-pilula">
                    <span>Ritmo Sugerido</span>
                    <strong>-- pts</strong>
                </div>
                <div id="legenda-feitos-dia" class="ds-legenda-pilula">
                    <span>Feitos Hoje</span>
                    <strong>-- pts</strong>
                </div>
            </div>

            <!-- O Protagonista: Bloco de Foco que se transforma -->
            <div id="container-feedback-diario" class="ds-feedback-diario-container">
                <!-- O conteúdo (pílula grande) será 100% controlado pelo JS -->
            </div>
        </div>

        

            <!-- SEÇÃO 2: PLANEJADOR SEMANAL (COM SLIDER) -->
            <div class="ds-resumo-semanal">
                <h3 class="ds-resumo-header">Planeje sua Meta Semanal</h3>
                <div class="ds-slider-container">
                    <input type="range" id="meta-slider" class="ds-meta-slider" min="0" max="100" value="0">
                    <div id="slider-ticks" class="ds-slider-ticks"></div>
                </div>
                <div id="feedback-meta-selecionada" class="ds-feedback-meta">
                    Meta: <span>--</span> (<span>-- pts</span>)
                </div>
                <div class="ds-feedback-duplo-container">
                    <div class="ds-feedback-item">
                        <span class="ds-feedback-label">Comissão Projetada</span>
                        <strong id="feedback-comissao" class="ds-feedback-valor">R$ --</strong>
                    </div>

                    <div class="ds-feedback-item">
                        <span class="ds-feedback-label">Faltam para o Alvo</span>
                        <strong id="feedback-pontos-faltantes" class="ds-feedback-valor">-- pts</strong>
                    </div>
                </div>
            </div>

        </section>

        <!-- <<< ADICIONE A NOVA SEÇÃO/CARD DE OBJETIVOS AQUI >>> -->
            <section id="secao-objetivos-meta" class="ds-card" style="display: none;">
                <!-- O JS controlará o título e o conteúdo aqui dentro -->
                <h2 id="objetivos-card-titulo" class="ds-card-titulo">Condições da Meta</h2>
                <div id="objetivos-meta-container" class="ds-objetivos-container">
                    <!-- O JS irá preencher esta área -->
                </div>
            </section>

        <!-- CARD DE DETALHAMENTO DE ATIVIDADES --> 
            <section class="ds-card ds-painel-detalhamento">
                <h2 class="ds-card-titulo">Detalhamento das Atividades</h2>
                
                <div class="ds-controles-detalhamento">
                    <button id="btn-abrir-filtros" class="ds-btn ds-btn-outline-primario">
                        <i class="fas fa-filter"></i> Busca e Filtro
                    </button>
                    <button id="btn-atualizar-atividades" class="ds-btn ds-btn-outline-primario">
                        <i class="fas fa-sync-alt"></i> Atualizar
                    </button>
                </div>
                
                <div id="filtros-ativos-container" class="ds-filtros-ativos-container"></div>
                
                <div id="totalizadores-detalhamento" class="ds-totalizadores-container"></div>
                
                <div class="ds-atividades-wrapper">
                    <ul id="listaAtividades" class="ds-atividades-lista"></ul>
                </div>
                
                <div id="paginacaoContainer" class="ds-paginacao">
                    <button id="btnAnterior" class="ds-btn ds-btn-outline-primario">
                        <i class="fas fa-chevron-left"></i> Anterior
                    </button>
                    <div id="paginacaoNumeros" class="ds-paginacao-numeros"></div>
                    <button id="btnProximo" class="ds-btn ds-btn-outline-primario">
                        Próximo <i class="fas fa-chevron-right"></i>
                    </button>
                </div>

                <!-- Overlay de carregamento para a lista de atividades -->
                <div id="lista-loading-overlay" class="ds-lista-loading-overlay">
                    <div class="ds-spinner-bolinhas">
                        <div class="bolinha bolinha-1"></div>
                        <div class="bolinha bolinha-2"></div>
                        <div class="bolinha bolinha-3"></div>
                    </div>
                </div>
            </section>
    </main>

    <!-- POPUPS, MODAIS E PAINÉIS LATERAIS -->

    <div id="popupGenerico" class="ds-popup-overlay">
        <div class="ds-popup-mensagem">
            <i id="popupIcone" class="fas ds-popup-icone"></i>
            <p id="popupMensagemTexto"></p>
            <button id="popupBotaoOk" class="ds-btn ds-btn-primario ds-btn-texto-claro">OK</button>
        </div>
    </div>
    
    <div id="comunicacoes-overlay" class="ds-side-painel-overlay">
        <div id="comunicacoes-painel" class="ds-side-painel">
            <div class="ds-side-painel-header">
                <h3>Central de Comunicação</h3>
                <button id="fechar-painel-comunicacoes" class="ds-btn-fechar-painel-padrao">X</button>
            </div>
            <div id="comunicacoes-painel-body" class="ds-side-painel-body">
                <div class="ds-spinner-container"><div class="ds-spinner"></div></div>
            </div>
           
        </div>
    </div>

    <div id="perfil-overlay" class="ds-side-painel-overlay">
        <div id="perfil-painel" class="ds-side-painel">
            <div id="perfil-painel-body" class="ds-side-painel-body">
                <div class="ds-spinner-container"><div class="ds-spinner"></div></div>
            </div>
        </div>
    </div>

    <div id="modal-ponto-atencao" class="ds-popup-overlay">
        <div class="ds-popup-mensagem">
            <button id="btn-fechar-pa" class="ds-btn-fechar-painel-padrao">X</button> 
            <h3 class="ds-modal-titulo">Enviar Ponto de Atenção</h3>
            <p style="font-size: 0.9rem; color: var(--ds-cor-cinza-texto-secundario); text-align: left;">
                Use este espaço para reportar problemas, falta de material, ou dar sugestões.
            </p>
            <form id="form-ponto-atencao" style="width: 100%; text-align: left; margin-top: 15px;">
                <div>
                    <label for="input-pa-titulo" style="font-weight: 600;">Assunto:</label>
                    <input type="text" id="input-pa-titulo" class="ds-input" required placeholder="Ex: Máquina travando">
                </div>
                <div style="margin-top: 15px;">
                    <label for="textarea-pa-conteudo" style="font-weight: 600;">Descrição:</label>
                    <textarea id="textarea-pa-conteudo" class="ds-input" rows="5" required placeholder="Descreva em detalhes."></textarea>
                </div>
                <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 15px;">
                    <button type="button" id="btn-cancelar-pa" class="ds-btn ds-btn-secundario">Cancelar</button>
                    <button type="submit" id="btn-enviar-pa" class="ds-btn ds-btn-primario">Enviar</button>
                </div>
            </form>
        </div>
    </div>

    <div id="painel-filtros-overlay" class="ds-bottom-sheet-overlay">
        <div id="painel-filtros-sheet" class="ds-bottom-sheet">
            <div class="ds-sheet-header">
                <h3>Buscar e Filtrar</h3>
                <button id="btn-fechar-filtros" class="ds-btn-fechar-sheet">×</button>
            </div>
            <div class="ds-sheet-body">
                <div class="ds-form-group">
                    <label for="input-busca-op">Buscar por OP / Arremate</label>
                    <input type="text" id="input-busca-op" class="ds-input" placeholder="Digite o número da OP...">
                </div>
                <div class="ds-form-group">
                    <label for="select-periodo">Período</label>
                    <select id="select-periodo" class="ds-select">
                        <option value="hoje">Hoje</option>
                        <option value="ontem">Ontem</option>
                        <option value="esta-semana">Esta Semana (Ciclo)</option>
                        <option value="semana-passada">Semana Passada (Ciclo)</option>
                        <option value="dia-especifico">Dia Específico...</option>
                        <option value="semana-especifica">Semana Específica...</option>
                    </select>
                    <input type="text" id="datepicker-dia-filtro" class="ds-input ds-datepicker-oculto">
                    <input type="text" id="datepicker-semana-filtro" class="ds-input ds-datepicker-oculto">
                </div>
                
            </div>
            <div class="ds-sheet-footer">
                <button id="btn-limpar-filtros" class="ds-btn ds-btn-secundario">Limpar</button>
                <button id="btn-aplicar-filtros" class="ds-btn ds-btn-primario ds-btn-texto-claro">Ver Resultados</button>
            </div>
        </div>
    </div>

    <!-- PAINEL LATERAL DE SUPORTE E PONTOS DE ATENÇÃO -->
        <div id="suporte-overlay" class="ds-side-painel-overlay">
            <div id="suporte-painel" class="ds-side-painel">
                <div class="ds-side-painel-header">
            <h3>Suporte & Sugestões</h3>
            <button id="fechar-painel-suporte" class="ds-btn-fechar-painel-padrao">X</button>
        </div>

        <div id="suporte-painel-body" class="ds-side-painel-body">
            <!-- Seus pontos de atenção e respostas aparecerão aqui -->
            <div class="ds-spinner-container">
                <div class="ds-spinner"></div>
            </div>
        </div>
        <div class="ds-side-painel-footer">
           <button id="btn-novo-ponto-atencao-suporte" class="ds-btn ds-btn-primario ds-btn-texto-claro">
                    <i class="fas fa-plus-circle"></i> Enviar Novo Ponto de Atenção
            </button>
        </div>
    </div>
</div>

    <!-- NOVO MODAL DE GALERIA DE AVATARES -->
    <div id="modal-galeria-avatar" class="ds-popup-overlay">
        <div class="ds-popup-mensagem ds-modal-galeria">
            
            <!-- CABEÇALHO DO MODAL -->
            <button class="ds-btn-fechar-painel-padrao" onclick="this.closest('.ds-popup-overlay').classList.remove('ativo')">X</button>
            <h3 class="ds-modal-titulo">Meus Avatares</h3>
            <p class="ds-modal-subtitulo">Clique em uma imagem para defini-la como sua foto de perfil principal.</p>
            
            <!-- GRID ONDE OS AVATARES APARECEM -->
            <div id="galeria-avatar-grid" class="ds-galeria-avatar-grid">
                <!-- Os slots de avatar serão carregados aqui pelo JavaScript -->
                <div class="ds-spinner-container">
                    <div class="ds-spinner"></div>
                </div>
            </div>

            <!-- RODAPÉ DO MODAL COM TEXTO DE AJUDA E BOTÃO GERENCIAR -->
            <div class="ds-galeria-avatar-footer">
                <p id="galeria-avatar-ajuda" class="ds-galeria-avatar-ajuda">Carregando...</p>
                <button id="btn-gerenciar-avatares" class="ds-btn ds-btn-secundario ds-btn-sm">Gerenciar</button>
            </div>

        </div>
    </div>


    <!-- RECURSOS -->
    <input type="file" id="input-avatar-upload" accept="image/*" style="display: none;">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/i18n/datepicker-pt-BR.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js"></script>
    <script src="/dashboard/dashboard.js" type="module"></script>

</body>
</html>